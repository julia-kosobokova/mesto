!function(){"use strict";class e{constructor(e,t,s,i,n,o,r){let{caption:a,image:l,likes:_,isMine:h,id:c}=e;this._id=c,this._caption=a,this._image=l,this._likes=_,this._isMine=h,this._templateSelector=t,this._handleCardClick=s,this._handleTrashClick=i,this._addLike=n,this._removeLike=o,this._userId=r}_getTemplate(){return document.querySelector(this._templateSelector).content.querySelector(".element").cloneNode(!0)}_handleLikeClick(){this._hasMyLike()?this._removeLike(this._id,this._setLikes.bind(this)):this._addLike(this._id,this._setLikes.bind(this))}_setLikes(e){this._likes=e,this._countLike.textContent=this._likes.length,this._updateLike()}_updateLike(){this._hasMyLike()?this._buttonLike.classList.add("element__like_active"):this._buttonLike.classList.remove("element__like_active")}_hasMyLike(){return this._likes.some((e=>this._userId===e._id))}_remove(){this._elementClone.remove(),this._elementClone=null}generateCard(){return this._elementClone=this._getTemplate(),this._buttonLike=this._elementClone.querySelector(".element__like"),this._buttonTrash=this._elementClone.querySelector(".element__trash"),this._isMine?this._buttonTrash.classList.add("element__trash_visible"):this._buttonTrash.classList.remove("element__trash_visible"),this._imageElement=this._elementClone.querySelector(".element__image"),this._captionElement=this._elementClone.querySelector(".element__caption"),this._countLike=this._elementClone.querySelector(".element__like-count"),this._captionElement.textContent=this._caption,this._imageElement.src=this._image,this._imageElement.alt=this._caption,this._countLike.textContent=this._likes.length,this._updateLike(),this._buttonLike.addEventListener("click",(()=>this._handleLikeClick())),this._buttonTrash.addEventListener("click",(()=>this._handleTrashClick(this._remove.bind(this),this._id))),this._imageElement.addEventListener("click",(()=>this._handleCardClick(this._image,this._caption))),this._elementClone}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class s{constructor(e,s){t(this,"_showInputError",((e,t)=>{const s=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.add(this._options.inputErrorClass),s.textContent=t,s.classList.add(this._options.errorClass)})),t(this,"_hideInputError",(e=>{const t=this._formElement.querySelector(".".concat(e.id,"-error"));e.classList.remove(this._options.inputErrorClass),t.classList.remove(this._options.errorClass),t.textContent=""})),t(this,"_checkInputValidity",(e=>{e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)})),t(this,"toggleButtonState",(()=>{this._hasInvalidInput()?this._disableSubmit():this._enableSubmit()})),t(this,"_setEventListeners",(()=>{this._inputList=Array.from(this._formElement.querySelectorAll(this._options.inputSelector)),this._buttonElement=this._formElement.querySelector(this._options.submitButtonSelector),this.toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))})),t(this,"_hasInvalidInput",(()=>this._inputList.some((e=>!e.validity.valid)))),this._options=e,this._formElement=s}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_disableSubmit(){this._buttonElement.classList.add(this._options.inactiveButtonClass),this._buttonElement.disabled=!0}_enableSubmit(){this._buttonElement.classList.remove(this._options.inactiveButtonClass),this._buttonElement.disabled=!1}enableValidation(){this._setEventListeners()}resetValidation(){this.toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}}class i{constructor(e){this._popup=document.querySelector(e),this._buttonClose=this._popup.querySelector(".popup__close-button"),this._escEventListener=this._handleEscClose.bind(this),this._overlayEventListener=this._closeOverlay.bind(this),this._closeEventListener=this.close.bind(this)}open(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._escEventListener)}close(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._escEventListener)}setEventListeners(){this._popup.addEventListener("mousedown",this._overlayEventListener),this._buttonClose.addEventListener("click",this._closeEventListener)}_handleEscClose(e){"Escape"===e.key&&this.close()}_closeOverlay(e){e.target===this._popup&&this.close(e.target)}}class n extends i{constructor(e,t){super(e),this._handleFormSubmit=t,this._form=this._popup.querySelector(".popup__form"),this._inputList=this._form.querySelectorAll(".popup__input"),this._saveButton=this._form.querySelector(".popup__save-button"),this._saveButtonOriginalText=this._saveButton.textContent}_getInputValues(){const e={};return this._inputList.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{this._handleFormSubmit(this._getInputValues()),e.preventDefault()}))}close(){super.close(),this._form.reset()}replaceSaveButtonText(e){this._saveButton.textContent=e}restoreSaveButtonText(){this._saveButton.textContent=this._saveButtonOriginalText}}const o={formSelector:".form",fieldsetSelector:".popup__form-set",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},r=new class{constructor(e){this._options=e}getUserInfo(){return fetch(this._options.baseUrl+"/users/me",{headers:this._options.headers}).then((e=>this._getResponseData(e)))}getInitialCards(){return fetch(this._options.baseUrl+"/cards",{headers:this._options.headers}).then((e=>this._getResponseData(e)))}saveUserInfo(e){return fetch(this._options.baseUrl+"/users/me",{method:"PATCH",headers:this._options.headers,body:JSON.stringify({name:e.name,about:e.description})}).then((e=>this._getResponseData(e)))}saveNewCard(e){return fetch(this._options.baseUrl+"/cards",{method:"POST",headers:this._options.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._getResponseData(e)))}deleteCard(e){return fetch(this._options.baseUrl+"/cards/"+e,{method:"DELETE",headers:this._options.headers}).then((e=>this._getResponseData(e)))}addLike(e){return fetch(this._options.baseUrl+"/cards/"+e+"/likes",{method:"PUT",headers:this._options.headers}).then((e=>this._getResponseData(e)))}removeLike(e){return fetch(this._options.baseUrl+"/cards/"+e+"/likes",{method:"DELETE",headers:this._options.headers}).then((e=>this._getResponseData(e)))}updateUserAvatar(e){return fetch(this._options.baseUrl+"/users/me/avatar",{method:"PATCH",headers:this._options.headers,body:JSON.stringify({avatar:e})}).then((e=>this._getResponseData(e)))}_getResponseData(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-46",headers:{authorization:"2e553a64-7c1d-4473-abd0-835bab4139ba","Content-Type":"application/json"}}),a=document.querySelector(".profile__edit-button"),l=document.querySelector(".profile__add-button"),_=document.querySelector(".profile__avatar-button"),h=document.querySelector(".popup_profile"),c=document.querySelector(".popup_element"),p=document.querySelector(".popup_avatar"),u=h.querySelector(".popup__input_type_name"),d=h.querySelector(".popup__input_type_description"),m=(p.querySelector(".popup__input_type_link"),h.querySelector(".popup__form")),v=c.querySelector(".popup__form"),f=p.querySelector(".popup__form"),L=new s(o,m),E=new s(o,v),b=new s(o,f);L.enableValidation(),E.enableValidation(),b.enableValidation();const S=new n(".popup_profile",(function(e){S.replaceSaveButtonText("Сохранение..."),r.saveUserInfo(e).then((e=>{const t={name:e.name,description:e.about,avatar:e.avatar,id:e._id};I.setUserInfo(t),S.close()})).catch((e=>{console.log(e)})).finally((()=>{S.restoreSaveButtonText()}))})),y=new n(".popup_avatar",(function(e){y.replaceSaveButtonText("Сохранение..."),r.updateUserAvatar(e.link).then((e=>{const t={name:e.name,description:e.about,avatar:e.avatar,id:e._id};I.setUserInfo(t),y.close()})).catch((e=>{console.log(e)})).finally((()=>{y.restoreSaveButtonText()}))})),k=new n(".popup_element",(function(e){k.replaceSaveButtonText("Сохранение..."),r.saveNewCard(e).then((e=>{T.addItem(e),k.close()})).catch((e=>{console.log(e)})).finally((()=>{k.restoreSaveButtonText()}))})),g=new class extends i{constructor(e,t){super(e),this._handleConfirmation=t,this._form=this._popup.querySelector(".popup__form"),this._confirmButton=this._form.querySelector(".popup__save-button")}_getAttributes(){return{handleRemoveElement:this._handleRemoveElement,cardId:this._cardId}}setHandleRemoveElement(e){this._handleRemoveElement=e}setCardId(e){this._cardId=e}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._confirmButton.addEventListener("click",(()=>{this._handleConfirmation(this._getAttributes())}))}}(".popup_confirm",(function(e){let{handleRemoveElement:t,cardId:s}=e;r.deleteCard(s).then((()=>{t(),g.close()}))})),C=new class extends i{constructor(e){super(e),this._image=this._popup.querySelector(".popup__image"),this._text=this._popup.querySelector(".popup__text")}open(e,t){super.open(),this._image.src=e,this._image.alt=t,this._text.textContent=t}}(".popup_image");S.setEventListeners(),y.setEventListeners(),k.setEventListeners(),g.setEventListeners(),C.setEventListeners();const I=new class{constructor(e){let{nameSelector:t,descriptionSelector:s,avatarSelector:i}=e;this._nameProfile=document.querySelector(t),this._descriptionProfile=document.querySelector(s),this._avatarProfile=document.querySelector(i)}getUserInfo(){const e={};return e.name=this._nameProfile.textContent,e.description=this._descriptionProfile.textContent,e.avatar=this._avatarProfile.src,e.id=this._id,e}setUserInfo(e){this._nameProfile.textContent=e.name,this._descriptionProfile.textContent=e.description,this._avatarProfile.src=e.avatar,this._id=e.id}}({nameSelector:".profile__name",descriptionSelector:".profile__description",avatarSelector:".profile__avatar"});function q(e,t){e.then((e=>t(e.likes))).catch((e=>console.log(e)))}function x(e,t){q(r.addLike(e),t)}function B(e,t){q(r.removeLike(e),t)}a.addEventListener("click",(()=>function(){const e=I.getUserInfo();u.value=e.name,d.value=e.description,L.resetValidation(),S.open()}())),l.addEventListener("click",(()=>(k.open(),void E.resetValidation()))),_.addEventListener("click",(()=>(I.getUserInfo(),b.resetValidation(),void y.open())));const T=new class{constructor(e,t){this._elements=document.querySelector(e),this._renderer=t}setInitialItems(e){e.forEach((e=>{const t=this._renderer(e);this._elements.append(t)}))}addItem(e){const t=this._renderer(e);this._elements.prepend(t)}}(".elements__list",(function(t){const{name:s,link:i,likes:n,owner:o,_id:r}=t,a=I.getUserInfo().id,l=o._id===a;return new e({caption:s,image:i,likes:n,isMine:l,id:r},"#element-template",U,w,x,B,a).generateCard()}));function U(e,t){C.open(e,t)}function w(e,t){g.setCardId(t),g.setHandleRemoveElement(e),g.open()}Promise.all([r.getUserInfo(),r.getInitialCards()]).then((e=>{let[t,s]=e;I.setUserInfo({name:t.name,description:t.about,avatar:t.avatar,id:t._id}),T.setInitialItems(s)})).catch((e=>{console.log(e)}))}();